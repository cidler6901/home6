<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Edit Announcements</title>
<style>
  body { font-family: Arial, sans-serif; padding:20px; background:#f0f2f5;}
  input, textarea, button { display:block; width:100%; margin:10px 0; padding:10px; font-size:16px; }
  textarea{height:150px;}
  .login { max-width:400px; margin:auto; background:white; padding:20px; border-radius:10px; box-shadow:0 4px 6px rgba(0,0,0,0.1);}
  .hidden{display:none;}
</style>
</head>
<body>

<div class="login" id="loginBox">
<h2>Admin Login</h2>
<input type="text" id="username" placeholder="Username">
<input type="password" id="password" placeholder="Password">
<button onclick="login()">Login</button>
</div>

<div class="hidden" id="editorBox">
<h2>Edit Announcement</h2>
<textarea id="announcementText"></textarea>
<button onclick="saveAnnouncement()">Save Announcement</button>
<button onclick="removeAnnouncement()" style="background:red;color:white;">Remove Announcement</button>
<p style="font-size:14px;color:#555;">All changes update announcement.json via GitHub API.</p>
</div>

<script>
const ADMIN_USER = "admin";
const ADMIN_PASS = "ci259026901";

// GitHub settings
const GITHUB_USER = "USERNAME"; // Replace with your GitHub username
const GITHUB_REPO = "REPO"; // Replace with your repo name
const FILE_PATH = "announcement.json";
const BRANCH = "main";
const TOKEN = "YOUR_GITHUB_PERSONAL_ACCESS_TOKEN"; // Create in GitHub settings

function login(){
  const u=document.getElementById('username').value;
  const p=document.getElementById('password').value;
  if(u===ADMIN_USER && p===ADMIN_PASS){
    document.getElementById('loginBox').classList.add('hidden');
    document.getElementById('editorBox').classList.remove('hidden');
    loadCurrentAnnouncement();
  } else alert("Incorrect username/password!");
}

// Fetch current announcement
function loadCurrentAnnouncement(){
  fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${FILE_PATH}?ref=${BRANCH}`)
  .then(res=>res.json())
  .then(data=>{
    const content = atob(data.content);
    const json = JSON.parse(content);
    document.getElementById('announcementText').value = json.announcement;
    window.currentSHA = data.sha;
  }).catch(err=>document.getElementById('announcementText').value = "");
}

// Save announcement
function saveAnnouncement(){
  const text = document.getElementById('announcementText').value.trim();
  if(!text) return alert("Cannot be empty");
  updateFileOnGitHub(text);
}

// Remove announcement
function removeAnnouncement(){
  if(confirm("Are you sure you want to remove announcement?")){
    updateFileOnGitHub("");
  }
}

// Update file on GitHub
function updateFileOnGitHub(text){
  const message = text ? "Update announcement" : "Remove announcement";
  const content = btoa(JSON.stringify({announcement:text}));
  fetch(`https://api.github.com/repos/${GITHUB_USER}/${GITHUB_REPO}/contents/${FILE_PATH}`,{
    method:"PUT",
    headers:{ "Authorization": `token ${TOKEN}`, "Content-Type":"application/json"},
    body: JSON.stringify({ message, content, sha: window.currentSHA, branch: BRANCH })
  }).then(res=>res.json())
  .then(data=>{
    alert("Announcement updated!");
    loadCurrentAnnouncement();
  }).catch(err=>alert("Error updating file: "+err));
}
</script>

</body>
</html>
